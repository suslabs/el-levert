SELECT COUNT(*) AS count FROM Tags WHERE ($user IS NULL OR owner = $user) AND ($flag IS NULL OR ((type & $flag) = CASE WHEN $flag < 0 THEN 0 ELSE $flag END));